{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"My notes on Nvidia Cumulus technical stuff","text":""},{"location":"#my-notes-on-nvidia-cumulus-technical-stuff","title":"My notes on Nvidia Cumulus technical stuff","text":"<p>Please see left panel for different topics</p>"},{"location":"interface-bond/","title":"Interface bond","text":"<pre><code>cumulus@SN3420M-02:mgmt:~$ nv show int bonds &lt;--5.11.0 new command\nInterface  Admin Status  Oper Status  Mode  Mlag ID  Lacp-rate  Lacp-bypass  Up-delay  Down-delay\n---------  ------------  -----------  ----  -------  ---------  -----------  --------  ----------\nbond1      up            up           lacp  1        fast       off          0         0\nbond2      up            down         lacp  2        fast       off          0         0\npeerlink   up            up           lacp           fast       off          0         0\ncumulus@SN3420M-02:mgmt:~$ nv show int bond-member\nError: Ambiguous Command:\n  show interface\n  show interface bond-members\ncumulus@SN3420M-02:mgmt:~$ nv show int bond-members &lt;--5.11.0 new command\nInterface  Parent    Admin Status  Oper Status  Speed  MTU\n---------  --------  ------------  -----------  -----  ----\nswp1       bond1     up            up           10G    9216\nswp2       bond2     up            up           10G    9216\nswp49      peerlink  up            up           40G    9216\n\n\n\ncumulus@SN3420M-01:mgmt:~$ nv show int bond1 bond member\n      bonding-state  mii-status\n----  -------------  ----------\nswp1  active         up\n\ncumulus@SN3420M-01:mgmt:~$ nv show int bond1 bond mlag\n                operational  applied  pending\n--------------  -----------  -------  -------\nenable                       on       on\nid              1            1        1\npeer-interface  bond1\nstatus          dual\n\n\ncumulus@SN3420M-01:mgmt:~$ cat /proc/net/bonding/bond1\nEthernet Channel Bonding Driver: v6.1.0-cl-1-amd64\n\nBonding Mode: IEEE 802.3ad Dynamic link aggregation\nTransmit Hash Policy: layer3+4 (1)\nMII Status: up\nMII Polling Interval (ms): 100\nUp Delay (ms): 0\nDown Delay (ms): 0\nPeer Notification Delay (ms): 0\n\n802.3ad info\nLACP active: on\nLACP rate: fast\nMin links: 1\nAggregator selection policy (ad_select): stable\n\nSlave Interface: swp1\nMII Status: up\nSpeed: 10000 Mbps\nDuplex: full\nLink Failure Count: 0\nPermanent HW addr: b0:cf:0e:4a:af:68\nSlave queue ID: 0\nAggregator ID: 1\nActor Churn State: none\nPartner Churn State: none\nActor Churned Count: 1\nPartner Churned Count: 1\n</code></pre>"},{"location":"interface-mgmt/","title":"Interface mgmt","text":"<pre><code>cumulus@SN3420M-01:mgmt:~$ ping -I mgmt 10.16.40.1\nvrf-wrapper.sh: switching to vrf \"default\"; use '--no-vrf-switch' to disable\n/usr/share/mgmt-vrf/bin/ping: Warning: source address might be selected on device other than: mgmt\nPING 10.16.40.1 (10.16.40.1) from 10.16.40.29 mgmt: 56(84) bytes of data.\n64 bytes from 10.16.40.1: icmp_seq=1 ttl=255 time=0.729 ms\n64 bytes from 10.16.40.1: icmp_seq=2 ttl=255 time=0.726 ms\n^C\n\ncumulus@SN3420M-01:mgmt:~$ ip route show vrf mgmt\ndefault via 10.16.40.1 dev eth0 proto kernel\nunreachable default metric 4278198272\n10.16.40.0/22 dev eth0 proto kernel scope link src 10.16.40.29\n127.0.0.0/8 dev mgmt proto kernel scope link src 127.0.0.1\n\n\ncumulus@SN3420M-01:mgmt:~$ ip vrf exec mgmt ping 10.16.40.1\nvrf-wrapper.sh: switching to vrf \"default\"; use '--no-vrf-switch' to disable\n/usr/share/mgmt-vrf/bin/ping: connect: Network is unreachable\n</code></pre>"},{"location":"interface/","title":"Interface","text":"<pre><code># Command available after 5.11\n$ nv show platform transceiver brief \nTransceiver  Identifier  Vendor name      Vendor PN         Vendor SN     Vendor revision\n-----------  ----------  ---------------  ----------------  ------------  ---------------\nswp1         SFP         FINISAR CORP.    FTLX8571D3BCL-HP  MU50PR6       A        \nswp2         SFP         FOXCONN          CUFCP32-CHB01-EF  CN02KBG0N0    A        \nswp49        QSFP+       Arista Networks  CAB-Q-Q-3M        ADY17120009K  20   \n\n# Command available after 5.11\n$ nv show platform transceiver swp1\ncable-type                  : Optical module\nsupported-cable-length      : 30m om1, 80m om2, 300m om3, 0m om4, 0m om5\nsupported-cable-length-smf  : 0m\ndiagnostics-status          : Diagnostic Data Available\nstatus                      : plugged_enabled\nerror-status                : N/A\nvendor-date-code            : 15080732\nidentifier                  : SFP\nvendor-rev                  : A\nvendor-name                 : FINISAR CORP.\nvendor-pn                   : FTLX8571D3BCL-HP\nvendor-sn                   : MU50PR6\nvendor-oui                  : 00:90:65\ntemperature:\n  temperature               : 29.18 C\n  high-alarm-threshold      : 78.00 C\n  low-alarm-threshold       : -13.00 C\n  high-warning-threshold    : 73.00 C\n  low-warning-threshold     : -8.00 C\n\n# Command available before 5.11\ncumulus@SN3420M-01:mgmt:~$ nv show interface swp1 pluggable\n             operational\n-----------  ----------------\nidentifier   SFP\nvendor-name  FINISAR CORP.\nvendor-pn    FTLX8571D3BCL-HP\nvendor-sn    MU50PR6\nvendor-rev   A\n\ncumulus@SN3420M-01:mgmt:~$ sudo ethtool -m swp1\n        Identifier                                : 0x03 (SFP)\n        Extended identifier                       : 0x04 (GBIC/SFP defined by 2-wire interface ID)\n        Connector                                 : 0x07 (LC)\n        Transceiver codes                         : 0x10 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n        Transceiver type                          : 10G Ethernet: 10G Base-SR\n        Encoding                                  : 0x06 (64B/66B)\n        BR, Nominal                               : 10300MBd\n        Rate identifier                           : 0x00 (unspec\n\ncumulus@SN3420M-01:mgmt:~$ sudo l1-show swp1\n[sudo] password for cumulus:\nPort:  swp1\n  Module Info\n      Vendor Name: FINISAR CORP.          PN: FTLX8571D3BCL-HP\n      Identifier: 0x03 (SFP)              Type: 10g-sr\n  Configured State\n      Admin: Admin Up     Speed: Unknown! MTU: 9216\n      Autoneg: On                         FEC: Auto\n  Operational State\n      Link Status: Kernel: Down           Hardware: Down\n      Speed: Kernel: Unknown!             Hardware: N/A\n      Autoneg: On (Autodetect enabld)     FEC: None (down)\n      TX Power (mW): [0.5496]\n      RX Power (mW): [0.0004]\n      Topo File Neighbor: None, None\n      LLDP Neighbor:      None, None\n  Port Hardware State:\n      Compliance Code: 10G Base-SR\n      Cable Type: Optical Module (separated)\n      Speed: N/A                          Autodetect: Enabled\n      Eyes: N/A                           Grade: 0\n      Troubleshooting Info: Negotiation failure\n</code></pre>"},{"location":"interface/#nvidia-cable-management-documentation","title":"Nvidia Cable Management Documentation","text":"<p>nvidia-cable-management-guidelines-and-faq.pdf</p>"},{"location":"inventory/","title":"Inventory","text":"<pre><code>$ nv show system\n                 operational                                  applied   \n---------------  -------------------------------------------  ----------\nbuild            Cumulus Linux 5.11.0                                   \nuptime           153 days, 11:18:39                                     \nhostname         SN3420M-01                                   SN3420M-01\nproduct-name     Cumulus Linux                                          \nproduct-release  5.9.1                                                  \nplatform         x86_64-mlnx_msn3420-r0                                 \nsystem-memory    3.10 GB used / 1.41 GB free / 7.40 GB total            \nswap-memory      0 Bytes used / 0 Bytes free / 0 Bytes total            \nhealth-status    OK                                                     \ndate-time        2025-10-01 19:05:38                                    \nstatus           N/A                                                    \ntimezone         US/Central                                   US/Central\nmaintenance                                                             \n  mode           disabled                                               \n  ports          enabled                                                \nversion                                                                 \n  kernel         6.1.0-cl-1-amd64                                       \n  build-date     Mon May 13 22:42:26 UTC 2024                           \n  image          5.9.1.0001                                             \n  onie           2022.08-5.3.0010-115200   \n</code></pre>"},{"location":"mlag/","title":"Mlag","text":"<pre><code>nv set interface bond1 bond member swp1\nnv set interface bond1 bond mlag id 1\nnv set interface bond1-2 bond mlag enable on\nnv set interface bond1-2 type bond\nnv set interface bond1-2 bridge domain br_default\nnv set interface bond2 bond member swp2\nnv set interface bond2 bond mlag id 2\nnv set interface peerlink bond member swp49\nnv set interface peerlink type peerlink\nnv set interface peerlink.4094 base-interface peerlink\nnv set interface peerlink.4094 type sub\nnv set interface peerlink.4094 vlan 4094\nnv set mlag backup 10.16.40.29 vrf mgmtm\nnv set mlag enable on\nnv set mlag mac-address 44:38:39:ff:00:01\n\n\ncumulus@SN3420M-01:mgmt:~$ nv show mlag\n                operational               applied\n--------------  ------------------------  -----------------\nenable          on                        on\nmac-address     44:38:39:ff:00:01         44:38:39:ff:00:01\npeer-ip         fe80::b2cf:eff:fe4a:f310  linklocal\npriority        32768                     32768\ninit-delay      180                       180\ndebug           off                       off\n\\[backup]        10.16.40.30               10.16.40.30\npeer-priority   32768\n**backup-active   True**\nbackup-vrf      mgmt\nlocal-id        b0:cf:0e:4a:af:10\npeer-id         b0:cf:0e:4a:f3:10\n**local-role      primary**\n**peer-role       secondary**\npeer-interface  peerlink.4094\n**peer-alive      True**\nbackup-reason\n\ncumulus@SN3420M-01:mgmt:~$ clagctl\nThe peer is alive\n     Our Priority, ID, and Role: 32768 b0:cf:0e:4a:af:10 primary\n    Peer Priority, ID, and Role: 32768 b0:cf:0e:4a:f3:10 secondary\n          Peer Interface and IP: peerlink.4094 fe80::b2cf:eff:fe4a:f310 (linklocal)\n                      Backup IP: 10.16.40.30 vrf mgmt (active)\n                     System MAC: 44:38:39:ff:00:01\n\nCLAG Interfaces\nOur Interface      Peer Interface     CLAG Id   Conflicts              Proto-Down Reason\n----------------   ----------------   -------   --------------------   -----------------\n           bond1   bond1              1         -                      -\n           bond2   -                  2         lacp partner mac       -\n                                                mismatch\n\ncumulus@SN3420M-02:mgmt:~$ clagctl showtimers\nTimers             Value     Time remaining\n----------------   -------   --------------\ninitDelay          180       00:00:00\npeerTimeout        20        00:00:20\nreloadTimer        300       00:00:00\nsendTimeout        30        -\n\n\n\ncumulus@SN3420M-01:mgmt:~$ nv show mlag consistency-checker\n\nGlobal Consistency-checker\n=\n    Parameter               LocalValue                PeerValue                 Conflict  Summary\n    ----------------------  ------------------------  ------------------------  --------  -------\n    anycast-ip              -                         -                         -           \n    bridge-priority         32768                     32768                     -           \n    bridge-stp-mode         rstp                      rstp                      -           \n    bridge-stp-state        on                        on                        -           \n    bridge-type             vlan-aware                vlan-aware                -           \n    clag-pkg-version        1.6.0-cl5.9.0u7           1.6.0-cl5.9.0u7           -           \n    clag-protocol-version   1.7.0                     1.7.0                     -           \n    peer-ip                 fe80::b2cf:eff:fe4a:f310  fe80::b2cf:eff:fe4a:f310  -           \n    peerlink-bridge-member  Yes                       Yes                       -           \n    peerlink-mtu            9216                      9216                      -           \n    peerlink-native-vlan    1                         1                         -           \n    peerlink-vlans          1, 161                    1, 161                    -           \n    redirect2-enable        yes                       yes                       -           \n    system-mac              44:38:39:ff:00:01         44:38:39:ff:00:01         -           \n\n\n\ncumulus@SN3420M-01:mgmt:~$ nv show interface --view=mlag-cc\nInterface  Parameter         LocalValue         PeerValue          Conflict\n---------  ----------------  -----------------  -----------------  -------------------------\nbond1      clag-id           1                  1                  -\n           lacp-partner-mac  22:00:a3:e0:00:03  22:00:a3:e0:00:03  -\n           lacp-actor-mac    44:38:39:ff:00:01  44:38:39:ff:00:01  -\n           vlan-id           1, 161             1, 161             -\n           native-vlan       1                  1                  -\n           master            br_default         NOT-SYNCED         -\n           mtu               9216               9216               -\n           bridge-learning   yes                yes                -\n           bpdu-guard        off                off                -\n           restricted-role   no                 no                 -\nbond2      clag-id           2                  2                  -\n           lacp-partner-mac  00:00:00:00:00:00  00:00:00:00:00:00  lacp partner mac mismatch\n           lacp-actor-mac    44:38:39:ff:00:01  44:38:39:ff:00:01  -\n           vlan-id           1, 161             1, 161             -\n           native-vlan       1                  1                  -\n           master            br_default         NOT-SYNCED         -\n           mtu               9216               9216               -\n           bridge-learning   yes                yes                -\n           bpdu-guard        off                off                -\n           restricted-role   no                 no                 -\n</code></pre>"},{"location":"mlag/#mlag-log","title":"MLAG LOG","text":"<pre><code>cumulus@SN3420M-01:mgmt:~$ sudo tail /var/log/clagd.log\n[sudo] password for cumulus:\n2025-04-30T09:54:46.170170+00:00 SN3420M-01 clagd[1763813]: Initial data sync to peer done.\n2025-04-30T09:56:11.861018+00:00 SN3420M-01 clagd[1763813]: STP param resync done to peer\n2025-04-30T09:56:11.861409+00:00 SN3420M-01 clagd[1763813]: neigh resync to peer done.\n2025-04-30T09:56:11.861631+00:00 SN3420M-01 clagd[1763813]: Resync Sent To Peer\n2025-04-30T09:57:41.913031+00:00 SN3420M-01 clagd[1763813]: STP param resync done to peer\n2025-04-30T09:57:41.913564+00:00 SN3420M-01 clagd[1763813]: neigh resync to peer done.\n2025-04-30T09:57:41.913708+00:00 SN3420M-01 clagd[1763813]: Resync Sent To Peer\n2025-04-30T09:57:43.068923+00:00 SN3420M-01 clagd[1763813]: HealthCheck: peerInitState changed\n2025-04-30T09:57:49.521260+00:00 SN3420M-01 clagd[1763813]: bond1 is now dual connected.\n2025-04-30T09:57:49.527473+00:00 SN3420M-01 clagd[1763813]: Conflict cleared (bond1): LACP partner MAC is no longer mismatched\n</code></pre>"},{"location":"routing/","title":"Routing","text":"<pre><code>cumulus@SN3420M-01:mgmt:~$ nv show vrf mgmt router rib ipv4 route\nRoute          Protocol   Distance  Uptime                NHGId  Metric  Flags\n-------------  ---------  --------  --------------------  -----  ------  ------------\n0.0.0.0/0      kernel     255       2025-04-28T17:35:22Z  3      8192    fib-selected\n                                                                         installed\n                                                                         selected\n10.16.40.0/24  connected  0         2025-04-28T22:30:59Z  35     0       fib-selected\n                                                                         installed\n                                                                         offloaded\n                                                                         selected\n\n\ncumulus@SN3420M-01:mgmt:~$ sudo ip rule add iif eth0 lookup mgmt\n\n\ncumulus@SN3420M-01:mgmt:~$ ip rule show\n98:     from all iif eth0 lookup mgmt\n99:     from all to 10.16.43.247 iif lo ipproto udp dport 53 lookup mgmt\n99:     from all to 10.16.43.246 iif lo ipproto udp dport 53 lookup mgmt\n1000:   from all lookup [l3mdev-table]\n32765:  from all lookup local\n32766:  from all lookup main\n32767:  from all lookup default\n</code></pre>"}]}