
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.21">
    
    
      
        <title>Home - Grafana</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.2a3383ac.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#nvidia-gpu-operator-setup-with-grafana-and-prometheus" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Grafana" class="md-header__button md-logo" aria-label="Grafana" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Grafana
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Home
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Grafana" class="md-nav__button md-logo" aria-label="Grafana" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Grafana
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Cluster Configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Cluster Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#p1-cluster-details" class="md-nav__link">
    <span class="md-ellipsis">
      P1 Cluster Details
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prometheus-helm-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Prometheus Helm Configuration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#c2-cluster-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      C2 Cluster Configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="C2 Cluster Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dcgm-exporter-overview" class="md-nav__link">
    <span class="md-ellipsis">
      DCGM Exporter Overview
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#servicemonitor-overview" class="md-nav__link">
    <span class="md-ellipsis">
      ServiceMonitor Overview
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#c2-cluster-details" class="md-nav__link">
    <span class="md-ellipsis">
      C2 Cluster Details
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#making-c2-dcgm-exporter-service-available-to-p1-prometheus" class="md-nav__link">
    <span class="md-ellipsis">
      Making C2 DCGM Exporter Service Available to P1 Prometheus
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Cluster Configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Cluster Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#p1-cluster-details" class="md-nav__link">
    <span class="md-ellipsis">
      P1 Cluster Details
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prometheus-helm-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Prometheus Helm Configuration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#c2-cluster-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      C2 Cluster Configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="C2 Cluster Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dcgm-exporter-overview" class="md-nav__link">
    <span class="md-ellipsis">
      DCGM Exporter Overview
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#servicemonitor-overview" class="md-nav__link">
    <span class="md-ellipsis">
      ServiceMonitor Overview
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#c2-cluster-details" class="md-nav__link">
    <span class="md-ellipsis">
      C2 Cluster Details
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#making-c2-dcgm-exporter-service-available-to-p1-prometheus" class="md-nav__link">
    <span class="md-ellipsis">
      Making C2 DCGM Exporter Service Available to P1 Prometheus
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="nvidia-gpu-operator-setup-with-grafana-and-prometheus">NVIDIA GPU Operator Setup with Grafana and Prometheus</h1>
<h2 id="overview">Overview</h2>
<p>Currently, two Kubernetes clusters are deployed: <code>p1</code> running Prometheus and <code>c2</code> running NVIDIA GPU Operator. Long-term, these may be consolidated into a single cluster for simplicity.</p>
<h2 id="cluster-configuration">Cluster Configuration</h2>
<p>Two Kubernetes clusters are running:</p>
<ul>
<li><strong>P1 cluster:</strong> Runs Grafana and Prometheus in the <code>monitoring</code> namespace</li>
<li><strong>P2 cluster:</strong> Has Grafana-Prometheus in the <code>monitoring</code> namespace</li>
</ul>
<p>The P1 cluster runs Grafana/Prometheus with the main prometheus-grafana service set up as NodePort on port 31600. Launch a web browser to <code>p1-worker-vm:31600</code>; the default login is <code>admin/prom-operator</code>.</p>
<h3 id="p1-cluster-details">P1 Cluster Details</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>wsl=&gt; k config current-context
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>p1-admin@p1.grafana
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>wsl=&gt; k get node
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>NAME                                STATUS   ROLES           AGE   VERSION
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>p1-master-vm.hst.enablement.local   Ready    control-plane   79d   v1.33.1
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>p1-worker-vm.hst.enablement.local   Ready    &lt;none&gt;          79d   v1.33.1
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>hjma@HSTHJMA02:~
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>wsl=&gt; k get svc -n monitoring
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>NAME                                       TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)                      AGE
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>alertmanager-operated                      ClusterIP   None             &lt;none&gt;        9093/TCP,9094/TCP,9094/UDP   54d
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>prometheus-operated                        ClusterIP   None             &lt;none&gt;        9090/TCP                     54d
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>test-prometheus-grafana                    NodePort    10.97.92.135     &lt;none&gt;        80:31600/TCP                 54d
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>test-prometheus-kube-prome-alertmanager    ClusterIP   10.100.1.114     &lt;none&gt;        9093/TCP,8080/TCP            54d
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>test-prometheus-kube-prome-operator        ClusterIP   10.100.184.136   &lt;none&gt;        443/TCP                      54d
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>test-prometheus-kube-prome-prometheus      ClusterIP   10.107.215.146   &lt;none&gt;        9090/TCP,8080/TCP            54d
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>test-prometheus-kube-state-metrics         ClusterIP   10.101.113.18    &lt;none&gt;        8080/TCP                     54d
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>test-prometheus-prometheus-node-exporter   ClusterIP   10.100.132.103   &lt;none&gt;        9100/TCP                     54d
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>wsl=&gt; curl 10.16.160.42:31600
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>&lt;a href=&quot;/login&quot;&gt;Found&lt;/a&gt;.
</span></code></pre></div>
<h3 id="prometheus-helm-configuration">Prometheus Helm Configuration</h3>
<p>In the P1 cluster, Grafana/Prometheus was set up using Helm:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>wsl=&gt; helm list -A --filter &#39;prometheus&#39;
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>NAME            NAMESPACE       REVISION        UPDATED                                 STATUS    CHART                            APP VERSION
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>test-prometheus monitoring      3               2025-07-22 17:11:52.125453 -0700 MST    deployed  kube-prometheus-stack-75.4.0     v0.83.0
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>hjma@HSTHJMA02:~
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>wsl=&gt; helm -n monitoring get values test-prometheus --revision 3
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>USER-SUPPLIED VALUES:
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>prometheus:
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>  prometheusSpec:
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>    additionalScrapeConfigs:
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>    - job_name: c2-dcgm-exporter
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>      static_configs:
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>      - targets:
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>        - 10.16.160.54:30639
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a>        - 10.16.160.54:30639
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a>hjma@HSTHJMA02:~
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a>wsl=&gt; helm -n monitoring get values test-prometheus --revision 2
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a>USER-SUPPLIED VALUES:
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a>prometheus:
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a>  prometheusSpec:
</span><span id="__span-1-21"><a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a>    additionalScrapeConfigs:
</span><span id="__span-1-22"><a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a>    - job_name: c2-dcgm-exporter
</span><span id="__span-1-23"><a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a>      static_configs:
</span><span id="__span-1-24"><a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a>      - targets:
</span><span id="__span-1-25"><a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a>        - 10.16.160.54:31065
</span><span id="__span-1-26"><a id="__codelineno-1-26" name="__codelineno-1-26" href="#__codelineno-1-26"></a>        - 10.16.160.55:31065
</span><span id="__span-1-27"><a id="__codelineno-1-27" name="__codelineno-1-27" href="#__codelineno-1-27"></a>hjma@HSTHJMA02:~
</span><span id="__span-1-28"><a id="__codelineno-1-28" name="__codelineno-1-28" href="#__codelineno-1-28"></a>wsl=&gt; helm -n monitoring get values test-prometheus --revision 1
</span><span id="__span-1-29"><a id="__codelineno-1-29" name="__codelineno-1-29" href="#__codelineno-1-29"></a>USER-SUPPLIED VALUES:
</span><span id="__span-1-30"><a id="__codelineno-1-30" name="__codelineno-1-30" href="#__codelineno-1-30"></a>null
</span><span id="__span-1-31"><a id="__codelineno-1-31" name="__codelineno-1-31" href="#__codelineno-1-31"></a>hjma@HSTHJMA02:~
</span></code></pre></div>
<h2 id="c2-cluster-configuration">C2 Cluster Configuration</h2>
<p>The C2 cluster has the GPU Operator in the <code>gpu-operator</code> namespace.</p>
<h3 id="dcgm-exporter-overview">DCGM Exporter Overview</h3>
<p>The NVIDIA GPU Operator Helm chart deploys a DCGM (Data Center GPU Manager) exporter by default, but there are important nuances:</p>
<ul>
<li>The DCGM exporter Pod will be created automatically when the operator detects a node with an NVIDIA GPU and the dcgm-exporter component is enabled in its values.</li>
<li>In the stock gpu-operator Helm chart from NVIDIA's repo, the DCGM exporter is enabled by default (<code>dcgmExporter.enabled: true</code>).</li>
</ul>
<p>However:</p>
<ol>
<li>ServiceMonitor is not enabled by default.</li>
<li>This means Prometheus won't automatically scrape the DCGM exporter unless you either:<ul>
<li>Enable the ServiceMonitor (<code>dcgmExporter.serviceMonitor.enabled: true</code>), or</li>
<li>Manually define a scrape config in Prometheus.</li>
</ul>
</li>
<li>No GPUs → No exporter pods</li>
<li>If the GPU Operator is installed into a cluster without GPU-capable nodes, the DaemonSet for dcgm-exporter may not schedule any pods.</li>
</ol>
<h3 id="servicemonitor-overview">ServiceMonitor Overview</h3>
<p>A ServiceMonitor is not a built-in Kubernetes object like a Pod, Deployment, or Service. It's a Custom Resource Definition (CRD) that comes from the Prometheus Operator (or kube-prometheus-stack Helm chart).</p>
<p><strong>How it works:</strong></p>
<ul>
<li>You first deploy Prometheus Operator (usually via kube-prometheus-stack Helm chart).</li>
<li>The Prometheus Operator introduces new CRDs, including:</li>
<li>ServiceMonitor</li>
<li>PodMonitor</li>
<li>PrometheusRule</li>
<li>Prometheus Operator watches for ServiceMonitor objects and dynamically updates Prometheus' scrape configuration to match them.</li>
</ul>
<p><strong>For NVIDIA GPU Operator:</strong></p>
<ul>
<li>If set to true, it will create a ServiceMonitor for the DCGM exporter so Prometheus can scrape GPU metrics automatically.</li>
<li>If you don't have Prometheus Operator installed, creating a ServiceMonitor will do nothing—because only the Prometheus Operator knows how to use it.</li>
</ul>
<h3 id="c2-cluster-details">C2 Cluster Details</h3>
<p>The DCGM exporter typically uses port <code>9400</code>.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>wsl=&gt; k config use-context c2-admin@c2.gpu
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>Switched to context &quot;c2-admin@c2.gpu&quot;.
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>hjma@HSTHJMA02:~
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>wsl=&gt; k get svc -n gpu-operator
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>NAME                   TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)    AGE
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>gpu-operator           ClusterIP   10.233.44.80   &lt;none&gt;        8080/TCP   23d
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>nvidia-dcgm-exporter   ClusterIP   10.233.15.59   &lt;none&gt;        9400/TCP   23d
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>hjma@HSTHJMA02:
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>wsl=&gt; helm list -A
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>NAME                    NAMESPACE       REVISION        UPDATED                                 STATUS          CHART                   APP VERSION
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>gpu-operator-1753140595 gpu-operator    1               2025-07-21 16:30:01.929686717 -0700 MST deployed        gpu-operator-v25.3.0    v25.3.0
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>wsl=&gt; helm show values nvidia/gpu-operator | grep -A20 dcgmExporter:
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a>dcgmExporter:
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a>  enabled: true
</span><span id="__span-2-19"><a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a>  repository: nvcr.io/nvidia/k8s
</span><span id="__span-2-20"><a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a>  image: dcgm-exporter
</span><span id="__span-2-21"><a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a>  version: 4.2.3-4.1.3-ubuntu22.04
</span><span id="__span-2-22"><a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a>  imagePullPolicy: IfNotPresent
</span><span id="__span-2-23"><a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a>  env:
</span><span id="__span-2-24"><a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a>    - name: DCGM_EXPORTER_LISTEN
</span><span id="__span-2-25"><a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a>      value: &quot;:9400&quot;
</span><span id="__span-2-26"><a id="__codelineno-2-26" name="__codelineno-2-26" href="#__codelineno-2-26"></a>    - name: DCGM_EXPORTER_KUBERNETES
</span><span id="__span-2-27"><a id="__codelineno-2-27" name="__codelineno-2-27" href="#__codelineno-2-27"></a>      value: &quot;true&quot;
</span><span id="__span-2-28"><a id="__codelineno-2-28" name="__codelineno-2-28" href="#__codelineno-2-28"></a>    - name: DCGM_EXPORTER_COLLECTORS
</span><span id="__span-2-29"><a id="__codelineno-2-29" name="__codelineno-2-29" href="#__codelineno-2-29"></a>      value: &quot;/etc/dcgm-exporter/dcp-metrics-included.csv&quot;
</span><span id="__span-2-30"><a id="__codelineno-2-30" name="__codelineno-2-30" href="#__codelineno-2-30"></a>  resources: {}
</span><span id="__span-2-31"><a id="__codelineno-2-31" name="__codelineno-2-31" href="#__codelineno-2-31"></a>  service:
</span><span id="__span-2-32"><a id="__codelineno-2-32" name="__codelineno-2-32" href="#__codelineno-2-32"></a>    internalTrafficPolicy: Cluster
</span><span id="__span-2-33"><a id="__codelineno-2-33" name="__codelineno-2-33" href="#__codelineno-2-33"></a>  serviceMonitor:
</span><span id="__span-2-34"><a id="__codelineno-2-34" name="__codelineno-2-34" href="#__codelineno-2-34"></a>    enabled: false
</span><span id="__span-2-35"><a id="__codelineno-2-35" name="__codelineno-2-35" href="#__codelineno-2-35"></a>    interval: 15s
</span><span id="__span-2-36"><a id="__codelineno-2-36" name="__codelineno-2-36" href="#__codelineno-2-36"></a>    honorLabels: false
</span><span id="__span-2-37"><a id="__codelineno-2-37" name="__codelineno-2-37" href="#__codelineno-2-37"></a>    additionalLabels: {}
</span></code></pre></div>
<h2 id="making-c2-dcgm-exporter-service-available-to-p1-prometheus">Making C2 DCGM Exporter Service Available to P1 Prometheus</h2>
<p>We can change the <code>dcgm-exporter</code> service from the default <code>ClusterIP</code> to <code>NodePort</code>. If we patch Kubernetes using <code>kubectl</code>, the change will not be persistent, as Helm values remain at their defaults. The next time you upgrade the gpu-operator Helm chart, the service will revert to ClusterIP. We need to modify Helm values to make the change persistent.</p>
<blockquote>
<p>[!NOTE]
After hours of investigation, Helm does not have a value to lock the NodePort port number. It can only define the type as NodePort and the <code>internalTrafficPolicy</code> field. Attempting to define NodePort 39400 to lock the port (preventing changes after restart or chart upgrade) resulted in "field not supported" errors. This limitation led to the decision to install Prometheus on the C2 cluster to avoid this complexity.</p>
<p>[!TIP]
This is a useful tip or suggestion.</p>
<p>[!IMPORTANT]
This is important information that users should not miss.</p>
<p>[!WARNING]
This is a warning about a potential issue or a caution.</p>
</blockquote>
<p>!!! note "Custom Title"
    Content here</p>
<p>??? note "Collapsible Note"
    Click to expand</p>
<p>!!! warning "Watch Out!"
    Important warning</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>